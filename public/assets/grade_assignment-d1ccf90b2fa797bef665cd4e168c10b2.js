function gradeHomework(){currentGrade().score=parseInt($("#custom_score_input").val()),currentGrade().graded=!0,styleToolbar(),saveGrade(currentGrade()),nextAnswer()}function setActiveAnswer(){$(".active").removeClass("active"),$(location.hash).addClass("active"),$("#current_student").text($(location.hash).children(".student_name").text()),$("#custom_score_input").val(currentGrade().score),getHomework(),setGradedAsGraded(),styleToolbar()}function nextAnswer(){grades[parseInt(location.hash.split("#")[1])+1]&&(location.hash=parseInt(location.hash.split("#")[1])+1),location.hash==""&&(location.hash="0"),(location.hash=="null"||location.hash=="NaN"||grades.indexOf(currentGrade())>grades.length-1)&&gradingComplete(),setGradedAsGraded()}function setGradedAsGraded(){for(index=0;index<grades.length;index++)grades[index].graded&&$("#"+index).addClass("graded")}function setGrades(){$.ajax({type:"GET",async:!1,url:window.location.pathname+"s.json",success:function(a){assignment=a,grades=a.grades}})}function setMaxHeight(){navigator.appName!="Microsoft Internet Explorer"?($("#answer_container").css("min-height",$(window).height()-62),$("#scribd").children("embed").attr("height",$(window).height()*.75)):($("#answer_container").css("min-height",$(window).height()-65),$("body").css("overflow","visible"))}function getHomework(){scribd_document=scribd.Document.getDoc(currentGrade().document_id,currentGrade().document_access_key),scribd_document.addParam("jsapi_version",1),scribd_document.addParam("hide_disabled_buttons",!0),scribd_document.write("scribd"),setMaxHeight()}function scoreHomeworkByPercent(a){$("#custom_score_input").val(assignment.score*a),gradeHomework()}function styleToolbar(){resetToolbarItems(),currentGrade().note!=""&&currentGrade().note&&$("#note").addClass("note_active"),currentGrade().score==assignment.score?$("#full").addClass("full_active"):currentGrade().score==assignment.score/2?$("#half").addClass("half_active"):currentGrade().score==0?$("#none").addClass("none_active"):currentGrade().score&&$("#custom_score").addClass("custom_active")}function resetToolbarItems(){$("#note").removeClass("note_active"),$("#none").removeClass("none_active"),$("#half").removeClass("half_active"),$("#full").removeClass("full_active"),$("#custom_score").removeClass("custom_active")}function saveGrade(a){return a=validateGrade(a),$.ajax({type:"PUT",url:"/grades/"+a.id,data:{grade:{score:a.score,graded:a.graded,note:a.note}},success:function(){return!0},fail:function(){return!1},error:function(){return!1}})}function addNote(){setNoteStyle(),resetNote(),noteDialog()}function gradingComplete(){$("#grading_complete").dialog({buttons:{"I'm Done":function(){window.location.pathname=window.location.pathname+"s/"},"Not Yet":function(){$(this).dialog("close")}}}),$("#grading_complete").children("p").css("color","black"),$("#grading_complete").children("p").css("font-size","12pt")}function currentGrade(){return grades[location.hash.split("#")[1]]}function setNoteStyle(){$("#notes_text").css("width","400px"),$("#notes_text").css("font-size","12pt"),$("#notes_text").css("float","center"),$("#notes_text").css("resize","none")}function resetNote(){if(currentGrade().note!=undefined||currentGrade().note==""||currentGrade().note=="null"||currentGrade()==null)return $("#notes_text").val(currentGrade().note)}function noteDialog(){$("#notes").dialog({width:"auto",buttons:{"Add Note":function(){currentGrade().note=$("#notes_text").val(),saveGrade(currentGrade()),styleToolbar(),$("#notes_text").val(""),$(this).dialog("close")},Cancel:function(){$("#notes_text").val(""),$(this).dialog("close")}}})}function validateGrade(a){return a.note=="null"&&(a.note=""),a}$(document).ready(function(){olark("api.box.hide"),$("#lacking_humility").hide(),setGrades(),location.hash="",setGradedAsGraded(),nextAnswer(),$(window).hashchange(function(){setActiveAnswer()}),$(window).resize(function(){setMaxHeight()}),$(".answer").click(function(){location.hash=$(this).attr("id")}),$("#full").click(function(){scoreHomeworkByPercent(1)}),$("#half").click(function(){scoreHomeworkByPercent(.5)}),$("#none").click(function(){scoreHomeworkByPercent(0)}),$("#note").click(function(){addNote()}),$("#custom_score_popup").keyup(function(a){a.which=="13"&&$("#custom_score_popup").children(".ui-dialog-buttonset").trigger("click")}),$("#custom_score").click(function(){$("#custom_score_popup").css("font-family","Georgia"),$("#custom_score_input").css("font-family","Georgia"),$("#custom_score_input").css("height","20px"),$("#custom_score_input").css("width","40px"),$("#custom_score_popup").css("text-align","center"),$("#custom_score_popup").dialog({buttons:{"Save Score":function(){$("#custom_score_popup").dialog("close"),gradeHomework()}}})})})